import { z } from "zod"

export const SeverityBreakdownSchema = z.object({
  critical: z.number().min(0).describe("Number of critical severity CVEs"),
  high: z.number().min(0).describe("Number of high severity CVEs"),
  medium: z.number().min(0).describe("Number of medium severity CVEs"),
  low: z.number().min(0).describe("Number of low severity CVEs"),
})

export const RecentCriticalSchema = z.object({
  cveId: z.string().optional().describe("CVE identifier"),
  description: z.string().describe("Brief description of the vulnerability"),
  date: z.string().optional().describe("Date discovered or disclosed"),
  severity: z.string().optional().describe("Severity level"),
})

export const CveAnalysisSchema = z.object({
  totalCVEs: z.number().min(0).describe("Total number of CVEs in the last 2 years"),
  severityBreakdown: SeverityBreakdownSchema.describe("Breakdown of CVEs by severity"),
  recentCritical: z.array(RecentCriticalSchema).describe("Recent critical vulnerabilities (last 6 months)"),
  avgPatchTime: z.string().describe("Average patch response time (e.g., '30 days', 'Unknown')"),
  trend: z.enum(["improving", "stable", "declining", "Unknown"]).describe("Trend analysis of CVE history"),
  notableIncidents: z.array(z.string()).describe("Array of notable security incidents related to CVEs"),
  sources: z.array(z.string().refine((val) => URL.canParse(val), {
    message: "Must be a valid URL",
  })).describe("Array of source URLs from research"),
})

export type SeverityBreakdown = z.infer<typeof SeverityBreakdownSchema>
export type RecentCritical = z.infer<typeof RecentCriticalSchema>
export type CveAnalysis = z.infer<typeof CveAnalysisSchema>

